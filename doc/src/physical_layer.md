# Physical Layer
The Physical layer consists of 8b/10b encoding and 5 parallel uart ports to transmit data. Flits are supplied and encoded/decoded by the 
phy managers into 8b/10b and are then sent to the parallel uarts. The phy managers are also responsible for inserting 8b/10b komma control flow 
into packet transmission. The phy_manager_rx also implements crc checking to ensure no issues in flit transmission.
### PHY Managers
The phy manager utilizes 8b 10b encoding which converts 8 bit words into 10 bit characters. This allows for extra error checking (only 256/1024 valid characters) and control flow insertion
(can use extra characters to indicate starting and stoping of packets). For control flow we use special coma characters that cannot be generated by the normal 8b/10b encoding to send
ack, grtcredit0, grtcredit1 commas for switch interface arbitration and start and stop commas for control flow at the phy level. 

The Phy manager rx consists of 2 distinct parts the actual 8b/10b decoder (can be seen in wrap_8b_10b_dec.sv) and the crc error detection with a header decoder.
this can be seen across the phy_manager_rx wrapper which holds the 8b_10b_dec_wrapper (responsible for latching the UART outptut) as well as extra logic to wrap
the decoder with the CRC and correctly time the output. 

The Phy manager tx consists of an arbitration buffer to arbitrate between commas and data flits and to store potential send requests to send across the link while the 
phy is currently working. It also has an 8b_10b_enc which encodes the data to the correct 10 bit characters and provides the correct comma when commas are arbitrated to. 

the below RTL shows the description of each file and the integration across the endnode. Then endnode has extra wrapping logic used to all for comma packets, a special kind of packet that gets converted to a comma on transmission and to take the phy manager rx and tx signals and convert them into the pulses required by the switches. 
![image](https://github.com/user-attachments/assets/f834f55e-b72a-4bf7-a763-bae0f8646f31)

____

### Module Definition
#### Endnode Interface
| Port Name          |   Direction   |  Description                                                                                                                                       |
| :------------------| :-----------: | :------------------------------------------------------------------------------------------------------------------------------------------------- |
| enc_flit_rx                 |  Input        | input encoded flit from phy rx                                                                                                                   |
| done_in_rx                |  Input       |  input done from phy                                                                                                                   |
| comma_length_sel_rx      |  Input        |  length of incoming message either 2 uart cycles 4 uart cycles or 10 uart cycles used to define comma vs data packet                          |
| err_in_rx     |  Input       |  error from phy                        |
| start_tx     |  Input        |  start signal from switch to tx                                |
| flit_tx        |  Input        |  incoming flit from switch to tx                      |
| done_tx   |  Input       |  done from Phy for tx                                                               |
| send_next_flit_tx        |  Input          |  step 1 of handshake request with get_data request for switch                                                                          |
| grt_cred_tx           |  Input       |  handles the credit granting from switch integrates into comma                                                                                       |
| get_data           |  Output       |  step 2 of handshake request with get_data request for switch response from switch                                                                                      |
| done_rx | Output|  1 pulse signal about done packet recieved |
| flit_rx | Output| output flit that signifies finsihed packet recieved  |
| data_out_tx | Output| output encoded flit for phy  |
| start_out_tx | Output| start signal to indicate begining of new packet for tx phy |
| comma_sel_tx_out | Output|  length of outgoing message either 2 uart cycles 4 uart cycles or 10 uart cycles used to define comma vs data packet |
| grt_cred_rx           |  Output       |  handles the credit granting to switch integrates from comma                                                                                       |
####


### 5-wide UART
The phy layer consists of 5 parallel UARTs  and can be seen in the /uarts directory. UART (Universal Asynchronous Reciever Transmitter) is a standard
protocol for asynchronous serial data transmission. UART generally sends 1 start bit with value 0 followed by a configurable length message (8-10 message bits)
followed by any number of parity bits(0 -2) and an end bit with a value 1. Since our implementation uses 8b/10b in the Phy Manager and we are using 5 parallel 
ports, we can gaurantee bit disparity across all 5 ports during a message transmission. This then means we can send variable length messages 
due to the gaurantee that there will not be a start bit or stop bit across all 5 ports at the same time.

TOP LEVEL: UART_BAUD   
parameters: 
    FREQUENCY ~ synthesized frequency of system
    PORTCOUNT ~ number of ports in UART
    EXPECTED_BAUD_RATE ~ expected baud rate for system

uart_rx_if ~ noteworthy interface signals
    uart_in ~ uart data in
    data ~ enc_flit out
    comma_sel ~ length of message used to calculate if incoming message is coma or not
    done_out ~ done output of rx 

uart_rx_if ~ noteworty interface signals
    data ~ enc_flit in
    uart_out ~ uart output out
    comma_sel ~ outgoing length of message select used to calculate if outgoing message is komma
    done ~ packet is odne sending
### Module Definition
#### Endnode Interface
| Port Name          |   Direction   |  Description                                                                                                                                       |
| :------------------| :-----------: | :------------------------------------------------------------------------------------------------------------------------------------------------- |
| FREQUENCY                 |  Param        | current syn frequency of design                                                                                                             |
| PORTCOUNT                |  Param       |  number of desired parallel ports choose between 5, 10, or 25                                                                                                                   |
| EXPECTED BAUG RATE      |  Param        |  desired baud rate                          |
| uart_rx_if.uart_data_in     |  Input       | PORTCOUNT width bit input data                        |
| uart_rx_if.enc_flit_out     |  Output        |  encoded flit going out from port                              |
| uart_rx_if.comma_sel        |  Output        |  outgoing uart cycle count                      |
| uart_rx_if.done_out   |  Output       |  done from phy rx                                                               |
| uart_tx_if.data        |  Input          |  encoded flit input to send                                                                        |
| uart_tx_if.comma_sel           |  Input       |  number of uart cycles to send current message on                                                                                       |
| uart_tx_if.done           |  Output       | response to finsihing sending current message                                                                                 |
| uart_tx_if.uart_out | Output|  PORTCOUNT width bit output data|
####
